<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --main: #FFB6C1;
            --light: #FFF0F2;
            --line: #FFE4E8;
            --deep: #FF9FB4;
            --text-dark: #555;
        }
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 8px; 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: transparent; 
            display: flex; 
            justify-content: center; 
        }
        
        .widget {
            background: #ffffff;
            border-radius: 18px;
            padding: 18px 16px 16px 16px;
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
            width: 100%;
            border: 1.5px solid var(--line);
            display: flex;
            flex-direction: column;
            gap: 0;
            position: relative;
            overflow: visible;
        }

        /* 헤더 */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 6px;
        }
        .goal-title { 
            font-size: 13px; 
            font-weight: 900; 
            color: var(--main); 
            letter-spacing: 1.5px; 
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #percent-text { 
            font-size: 12px; 
            font-weight: 800; 
            color: var(--main); 
        }

        /* 설정 버튼 */
        .settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
            padding: 0;
        }
        .settings-btn svg {
            width: 15px;
            height: 15px;
            stroke: var(--main);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.2s;
        }
        .settings-btn:hover {
            background: var(--light);
        }
        .settings-btn:hover svg {
            stroke: var(--deep);
        }

        /* 퍼센티지 바 */
        .bar-bg { 
            background: var(--light); 
            height: 5px; 
            border-radius: 10px; 
            overflow: hidden; 
            margin-bottom: 14px;
        }
        .bar-fill { 
            height: 100%; 
            background: linear-gradient(to right, var(--main), var(--deep));
            width: 0%; 
            transition: width 1s ease;
            border-radius: 10px;
        }

        /* 위시 리스트 */
        .wish-list { 
            list-style: none; 
            padding: 0; 
            margin: 0 0 10px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* 카드 스타일 위시 아이템 */
        .wish-item {
            background: white;
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 7px 8px 7px 10px;
            display: flex; 
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .wish-item:hover {
            border-color: var(--main);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
            transform: translateY(-1px);
        }
        .wish-item.is-now {
            background: var(--light);
            border-color: var(--main);
        }
        .wish-item.is-now:hover {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.09);
        }

        /* 왼쪽 영역 */
        .wish-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
            min-width: 0;
        }
        .wish-text-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .wish-text {
            font-size: 13px;
            color: var(--text-dark);
            font-weight: 500;
        }
        .now-badge {
            font-size: 9px;
            font-weight: 800;
            color: var(--deep);
            background: var(--light);
            padding: 2px 6px;
            border-radius: 6px;
            letter-spacing: 0.5px;
        }

        /* 월 태그 */
        .wish-month-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
        }
        .wish-month {
            font-size: 9px;
            background: var(--line);
            color: var(--deep);
            padding: 2px 7px;
            border-radius: 8px;
            font-weight: 700;
        }
        .wish-item.is-now .wish-month {
            background: var(--main);
            color: white;
        }

        /* X 버튼 */
        .delete-btn {
            background: none;
            border: 1px solid transparent;
            color: #ccc;
            font-size: 14px;
            cursor: pointer;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-left: 6px;
        }
        .wish-item:hover .delete-btn {
            opacity: 1;
            border-color: var(--line);
        }
        .delete-btn:hover {
            color: var(--deep);
            border-color: var(--main);
            background: var(--light);
        }

        /* 키패드 */
        .month-keypad {
            padding: 10px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--line);
            animation: slideDown 0.25s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-6px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .month-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        .month-btn {
            background: white;
            color: var(--text-dark);
            border: 1px solid var(--line);
            padding: 6px 2px;
            border-radius: 7px;
            font-size: 11px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
        }
        .month-btn:hover {
            background: var(--main);
            color: white;
        }
        .month-btn.selected {
            background: var(--main);
            color: white;
        }
        .month-btn.is-current {
            border-color: var(--deep);
            color: var(--deep);
            font-weight: 800;
        }
        .month-btn.is-current.selected {
            color: white;
        }

        /* 입력창 */
        .add-wish-container {
            padding: 0;
            position: relative;
        }
        .add-wish-input {
            width: 100%;
            border: 1px solid var(--line);
            background: white;
            border-radius: 10px;
            padding: 10px 36px 10px 12px;
            outline: none;
            font-size: 13px;
            color: var(--text-dark);
            transition: all 0.2s;
        }
        .add-wish-input::placeholder {
            color: #bbb;
        }
        .add-wish-input:focus {
            border-color: var(--main);
            background: var(--light);
        }
        .add-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            color: var(--main);
            border: none;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1;
            padding: 0;
        }
        .add-btn:hover {
            color: var(--deep);
            transform: translateY(-50%) scale(1.15);
        }

        @keyframes cardFade {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        .wish-item.pop {
            animation: cardFade 0.2s ease;
        }

        /* 2열 레이아웃 모드 */
        .wish-list.two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }
        .wish-list.two-col .month-keypad {
            grid-column: 1 / -1; /* 키패드는 항상 전체폭 */
        }

        /* ===== 테마 설정창 (Apple Style) ===== */
        .theme-panel {
            position: absolute;
            top: 36px;
            right: 0px;
            background: rgba(255,255,255,0.92);
            backdrop-filter: saturate(1.8) blur(20px);
            -webkit-backdrop-filter: saturate(1.8) blur(20px);
            border: 1px solid rgba(255,255,255,0.6);
            border-radius: 18px;
            padding: 20px 20px 22px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0,0,0,0.04);
            z-index: 50;
            display: none;
            width: 190px;
        }
        .theme-panel.open {
            display: block;
            animation: panelFade 0.22s cubic-bezier(.28,.44,.6,1);
        }
        @keyframes panelFade {
            from { opacity: 0; transform: translateY(-6px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* 섹션 타이틀 — 가볍고 연하게 */
        .panel-section-title {
            font-size: 11px;
            font-weight: 500;
            color: #999;
            margin-bottom: 12px;
            margin-top: 0;
        }

        /* 테마 원 행 — 수평 중앙 정렬 */
        .theme-grid {
            display: flex;
            justify-content: center;
            gap: 18px;
        }
        .theme-circle-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 7px;
            cursor: pointer;
        }
        .theme-circle {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.06);
            transition: all 0.2s ease;
            position: relative;
        }
        /* 활성: 테마색 테두리만 — ring 없이 조용하게 */
        .theme-circle-wrap.active .theme-circle {
            border-width: 2.5px;
            border-color: rgba(0,0,0,0.18);
        }
        .theme-circle-wrap.active .theme-circle::after {
            content: '';
            position: absolute;
            inset: -4.5px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.15);
        }
        .theme-circle-label {
            font-size: 10px;
            color: #aaa;
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        .theme-circle-wrap.active .theme-circle-label {
            color: #666;
            font-weight: 600;
        }

        /* 구분선 — iOS 스타일 얇고 연한 회색 */
        .panel-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 18px 0 16px;
        }

        /* 색상 설정 행 — iOS 설정 앱 스타일 */
        .color-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 36px;
        }
        .color-row + .color-row {
            border-top: 1px solid #f5f5f5;
        }
        .color-row-label {
            font-size: 13px;
            color: #333;
            font-weight: 400;
        }
        /* 원형 색상 피커 */
        .color-input-wrap {
            position: relative;
            width: 28px;
            height: 28px;
        }
        .color-input {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            opacity: 0;
            z-index: 1;
        }
        .color-preview {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.08);
            transition: border-color 0.2s, box-shadow 0.2s;
            pointer-events: none;
        }
        .color-input-wrap:hover .color-preview {
            box-shadow: 0 0 0 2px rgba(0,0,0,0.06);
        }

        /* iOS 토글 스위치 */
        .toggle-wrap {
            width: 42px;
            height: 24px;
            border-radius: 12px;
            background: #ddd;
            position: relative;
            cursor: pointer;
            transition: background 0.25s ease;
            flex-shrink: 0;
        }
        .toggle-wrap.on {
            background: var(--main);
        }
        .toggle-knob {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.25s ease;
        }
        .toggle-wrap.on .toggle-knob {
            left: 20px;
        }
    </style>
</head>
<body>

<div class="widget">
    <div class="header">
        <div class="goal-title">2026 GOAL</div>
        <div class="header-right">
            <div id="percent-text">0%</div>
            <button class="settings-btn" onclick="toggleThemePanel(event)">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- 테마 설정 창 (Apple Style) -->
    <div class="theme-panel" id="theme-panel">
        <div class="panel-section-title">테마</div>
        <div class="theme-grid" id="theme-grid"></div>

        <div class="panel-divider"></div>
        <div class="panel-section-title">색상 조정</div>
        <div class="color-row">
            <span class="color-row-label">기본색</span>
            <div class="color-input-wrap">
                <input type="color" class="color-input" id="color-main" oninput="onColorChange('main', this.value)">
                <div class="color-preview" id="preview-main"></div>
            </div>
        </div>
        <div class="color-row">
            <span class="color-row-label">서브색</span>
            <div class="color-input-wrap">
                <input type="color" class="color-input" id="color-deep" oninput="onColorChange('deep', this.value)">
                <div class="color-preview" id="preview-deep"></div>
            </div>
        </div>
        <div class="color-row">
            <span class="color-row-label">강조색</span>
            <div class="color-input-wrap">
                <input type="color" class="color-input" id="color-line" oninput="onColorChange('line', this.value)">
                <div class="color-preview" id="preview-line"></div>
            </div>
        </div>

        <div class="panel-divider"></div>
        <div class="panel-section-title">레이아웃</div>
        <div class="color-row">
            <span class="color-row-label">2열 정렬</span>
            <div class="toggle-wrap" id="toggle-layout" onclick="toggleLayout()">
                <div class="toggle-knob"></div>
            </div>
        </div>
    </div>

    <div class="bar-bg">
        <div id="bar" class="bar-fill"></div>
    </div>

    <ul id="wish-list" class="wish-list"></ul>

    <div class="add-wish-container">
        <input type="text" class="add-wish-input" id="add-wish-input" placeholder="Write your wish ｡.✩ ⊹" onkeypress="handleAddWish(event)">
        <button class="add-btn" onclick="addWishFromButton()">+</button>
    </div>
</div>

<script>
    /* ===== 테마 정의 (밝은 파스텔 톤) ===== */
    const themes = {
        pink: {
            label: '핑크',
            main: '#F8C0CB',
            deep: '#F0A0B0',
            line: '#FCDFE5',
            light: '#FFF5F6'
        },
        lavender: {
            label: '라벤더',
            main: '#D5CCEE',
            deep: '#B8A8E0',
            line: '#EBE7F5',
            light: '#F6F4FB'
        },
        sky: {
            label: '하늘색',
            main: '#BDE4F0',
            deep: '#85CCDF',
            line: '#E3F2F8',
            light: '#F4FAFC'
        }
    };

    let currentTheme = localStorage.getItem('widget_theme') || 'pink';
    // 세부 색상 오버라이드 (사용자 직접 조정한 값)
    let colorOverrides = JSON.parse(localStorage.getItem('widget_color_overrides')) || {};

    /* ===== 현재 테마의 실제 적용 색상 계산 ===== */
    function getActiveColors() {
        const base = themes[currentTheme];
        const ov = colorOverrides[currentTheme] || {};
        return {
            main: ov.main || base.main,
            deep: ov.deep || base.deep,
            line: ov.line || base.line,
            light: ov.light || base.light
        };
    }

    /* ===== 테마 적용 ===== */
    function applyTheme(key) {
        currentTheme = key;
        localStorage.setItem('widget_theme', key);
        const colors = getActiveColors();
        const root = document.documentElement;
        root.style.setProperty('--main', colors.main);
        root.style.setProperty('--deep', colors.deep);
        root.style.setProperty('--line', colors.line);
        root.style.setProperty('--light', colors.light);
        renderThemeGrid();
        syncColorPickers();
    }

    /* 세부 색상 변경 시 → light도 자동 생성 */
    function hexToLight(hex) {
        // hex → RGB → 좀 밝고 연한 버전 생성
        let r = parseInt(hex.slice(1,3), 16);
        let g = parseInt(hex.slice(3,5), 16);
        let b = parseInt(hex.slice(5,7), 16);
        // 흰색과 85% 혼합
        r = Math.round(r * 0.15 + 255 * 0.85);
        g = Math.round(g * 0.15 + 255 * 0.85);
        b = Math.round(b * 0.15 + 255 * 0.85);
        return '#' + [r,g,b].map(v => v.toString(16).padStart(2,'0')).join('');
    }

    function onColorChange(type, val) {
        if (!colorOverrides[currentTheme]) colorOverrides[currentTheme] = {};
        colorOverrides[currentTheme][type] = val;
        // light은 main 기반으로 자동 생성
        colorOverrides[currentTheme].light = hexToLight(colorOverrides[currentTheme].main || themes[currentTheme].main);
        localStorage.setItem('widget_color_overrides', JSON.stringify(colorOverrides));
        // 즉시 적용
        const colors = getActiveColors();
        const root = document.documentElement;
        root.style.setProperty('--' + type, val);
        root.style.setProperty('--light', colors.light);
        // preview 업데이트
        document.getElementById('preview-' + type).style.background = val;
        // 테마 원도 업데이트
        renderThemeGrid();
    }

    /* 테마 원 그리드 렌더링 */
    function renderThemeGrid() {
        const grid = document.getElementById('theme-grid');
        grid.innerHTML = '';
        Object.keys(themes).forEach(key => {
            const colors = (function() {
                const base = themes[key];
                const ov = colorOverrides[key] || {};
                return { main: ov.main || base.main };
            })();

            const wrap = document.createElement('div');
            wrap.className = 'theme-circle-wrap' + (key === currentTheme ? ' active' : '');
            wrap.onclick = () => applyTheme(key);

            const circle = document.createElement('div');
            circle.className = 'theme-circle';
            circle.style.background = colors.main;

            const label = document.createElement('div');
            label.className = 'theme-circle-label';
            label.innerText = themes[key].label;

            wrap.appendChild(circle);
            wrap.appendChild(label);
            grid.appendChild(wrap);
        });
    }

    /* 피커 값을 현재 색상과 동기 + preview 업데이트 */
    function syncColorPickers() {
        const colors = getActiveColors();
        document.getElementById('color-main').value = colors.main;
        document.getElementById('color-deep').value = colors.deep;
        document.getElementById('color-line').value = colors.line;
        document.getElementById('preview-main').style.background = colors.main;
        document.getElementById('preview-deep').style.background = colors.deep;
        document.getElementById('preview-line').style.background = colors.line;
    }

    /* 테마 창 열기/닫기 */
    function toggleThemePanel(e) {
        e.stopPropagation();
        document.getElementById('theme-panel').classList.toggle('open');
    }
    document.addEventListener('click', function(e) {
        const panel = document.getElementById('theme-panel');
        if (panel.classList.contains('open') && !panel.contains(e.target) && !e.target.closest('.settings-btn')) {
            panel.classList.remove('open');
        }
    });

    /* ===== 기존 기능 ===== */
    let wishes = JSON.parse(localStorage.getItem('wishes_2026_v2')) || [];
    let currentEditIndex = -1;
    const currentMonth = new Date().getMonth() + 1;

    function init() {
        applyTheme(currentTheme);
        initLayout();
        renderWishes();
        updateProgress();
    }

    function updateProgress() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 1);
        const end = new Date(now.getFullYear(), 11, 31);
        const percent = (((now - start) / (end - start)) * 100).toFixed(1);
        document.getElementById('bar').style.width = percent + '%';
        document.getElementById('percent-text').innerText = percent + '%';
    }

    function handleAddWish(event) { if (event.key === 'Enter') addWish(); }
    function addWishFromButton() { addWish(); }

    function addWish() {
        const input = document.getElementById('add-wish-input');
        const val = input.value.trim();
        if (val) {
            wishes.push({ text: val, months: [] });
            saveData();
            renderWishes(wishes.length - 1);
            input.value = '';
        }
    }

    function deleteWish(index) {
        wishes.splice(index, 1);
        if (currentEditIndex === index) closeKeypad();
        else if (currentEditIndex > index) currentEditIndex--;
        saveData();
        renderWishes();
    }

    function createKeypad() {
        const keypad = document.createElement('li');
        keypad.className = 'month-keypad';
        keypad.id = 'month-keypad';
        const grid = document.createElement('div');
        grid.className = 'month-grid';
        const selectedMonths = wishes[currentEditIndex].months;
        for (let i = 1; i <= 12; i++) {
            const btn = document.createElement('button');
            btn.className = 'month-btn';
            btn.innerText = i + '月';
            if (selectedMonths.includes(i)) btn.classList.add('selected');
            if (i === currentMonth) btn.classList.add('is-current');
            btn.onclick = (e) => { e.stopPropagation(); toggleMonth(i); };
            grid.appendChild(btn);
        }
        keypad.appendChild(grid);
        return keypad;
    }

    function openKeypad(index) {
        if (currentEditIndex === index) { closeKeypad(); return; }
        closeKeypad();
        currentEditIndex = index;
        const items = document.getElementById('wish-list').querySelectorAll('.wish-item');
        items[index].after(createKeypad());
    }

    function closeKeypad() {
        const existing = document.getElementById('month-keypad');
        if (existing) existing.remove();
        currentEditIndex = -1;
    }

    function toggleMonth(month) {
        if (currentEditIndex === -1) return;
        const months = wishes[currentEditIndex].months;
        const idx = months.indexOf(month);
        if (idx !== -1) months.splice(idx, 1);
        else { months.push(month); months.sort((a, b) => a - b); }
        saveData();

        // 키패드 버튼 즉시 업데이트
        document.querySelectorAll('.month-btn').forEach((btn, i) => {
            btn.classList.toggle('selected', months.includes(i + 1));
        });

        // 카드 전체 다시 렌더 (sorted 순서 불일치 방지)
        const editingIndex = currentEditIndex;
        renderWishes();
        // 키패드 다시 열기 (같은 위치)
        currentEditIndex = editingIndex;
        const items = document.getElementById('wish-list').querySelectorAll('.wish-item');
        // sorted 순서로 찾아야 하므로 wish text로 매칭
        const editingText = wishes[editingIndex].text;
        items.forEach((item, i) => {
            if (item.querySelector('.wish-text').innerText === editingText) {
                item.after(createKeypad());
            }
        });
    }

    /* ===== 레이아웃 토글 ===== */
    let isTwoCol = localStorage.getItem('widget_layout') === 'two';

    function initLayout() {
        const toggle = document.getElementById('toggle-layout');
        if (isTwoCol) {
            toggle.classList.add('on');
            document.getElementById('wish-list').classList.add('two-col');
        }
    }
    function toggleLayout() {
        isTwoCol = !isTwoCol;
        localStorage.setItem('widget_layout', isTwoCol ? 'two' : 'one');
        document.getElementById('toggle-layout').classList.toggle('on', isTwoCol);
        document.getElementById('wish-list').classList.toggle('two-col', isTwoCol);
    }

    document.addEventListener('click', function(e) {
        if (currentEditIndex === -1) return;
        const keypad = document.getElementById('month-keypad');
        const wishList = document.getElementById('wish-list');
        if (keypad && !keypad.contains(e.target) && !wishList.contains(e.target)) closeKeypad();
    });

    function renderWishes(popIndex) {
        const listEl = document.getElementById('wish-list');
        listEl.innerHTML = '';
        // 2열 모드 유지
        if (isTwoCol) listEl.classList.add('two-col');
        else listEl.classList.remove('two-col');
        const nowWishes = [], otherWishes = [];
        wishes.forEach((wish, index) => {
            if (wish.months.includes(currentMonth)) nowWishes.push({ wish, index });
            else otherWishes.push({ wish, index });
        });
        const sorted = [...nowWishes, ...otherWishes];
        if (sorted.length === 0) return;

        sorted.forEach(({ wish, index }) => {
            const li = document.createElement('li');
            li.className = 'wish-item';
            if (index === popIndex) li.classList.add('pop');
            const isNow = wish.months.includes(currentMonth);
            if (isNow) li.classList.add('is-now');

            const left = document.createElement('div');
            left.className = 'wish-left';

            const textRow = document.createElement('div');
            textRow.className = 'wish-text-row';
            const textContent = document.createElement('span');
            textContent.className = 'wish-text';
            textContent.innerText = wish.text;
            textRow.appendChild(textContent);
            if (isNow) {
                const badge = document.createElement('span');
                badge.className = 'now-badge';
                badge.innerText = 'now';
                textRow.appendChild(badge);
            }
            left.appendChild(textRow);

            if (wish.months && wish.months.length > 0) {
                const tagsWrap = document.createElement('div');
                tagsWrap.className = 'wish-month-tags';
                wish.months.forEach(m => {
                    const tag = document.createElement('span');
                    tag.className = 'wish-month';
                    tag.innerText = m + '月';
                    tagsWrap.appendChild(tag);
                });
                left.appendChild(tagsWrap);
            }

            left.onclick = (e) => { e.stopPropagation(); openKeypad(index); };

            const delBtn = document.createElement('button');
            delBtn.className = 'delete-btn';
            delBtn.innerHTML = '×';
            delBtn.onclick = (e) => { e.stopPropagation(); deleteWish(index); };

            li.appendChild(left);
            li.appendChild(delBtn);
            listEl.appendChild(li);
        });
    }

    function saveData() { localStorage.setItem('wishes_2026_v2', JSON.stringify(wishes)); }

    init();
</script>
</body>
</html>
